# 项目结构

Revideo 项目的结构与大多数 TypeScript 项目类似。以下是当你运行 `npm init @revideo@latest` 时初始化的默认项目结构：

```
my-project/
├── package.json
├── package-lock.json
├── tsconfig.json
├── vite.config.ts
├── src/
│   ├── project.ts
│   ├── render.ts
│   ├── project.meta
│   └── scenes/
│       └── example.tsx
└── public/
    └── my-video.mp4
```

让我们来了解最重要的文件：

### `./src/scenes/example.tsx`

`./src/scenes` 文件夹中的文件（如 `example.tsx`）是你需要最频繁修改的文件，用于定义视频模板。场景描述了你的视频应该呈现的样子。这些文件需要导出一个默认函数，该函数通过调用 `makeScene2D` 来生成一个描述所需视频效果的生成器函数：

```tsx
import {Video, makeScene2D} from '@revideo/2d';
import {waitFor} from '@revideo/core';

export default makeScene2D(function* (view) {
  const videoFile = useScene().variables.get(
    'video',
    'https://revideo-example-assets.s3.amazonaws.com/stars.mp4',
  )();

  yield view.add(<Video src={videoFile} size={['100%', '100%']} play={true} />);

  yield* waitFor(10);
});
```

### `./src/project.ts`

你的项目文件有两个作用：

1. 定义场景数组以创建完整视频
2. 接受视频变量，这些变量会在你使用可视化编辑器（运行 `npm start` 时）查看视频时传递给你的视频

```tsx
import {makeProject} from '@revideo/core';

import example from './scenes/example?scene';
import example2 from './scenes/example2?scene';

export default makeProject({
  scenes: [example, example2],
  variables: {
    video: 'https://revideo-example-assets.s3.amazonaws.com/beach.mp4',
  },
});
```

当指定多个场景时，这些场景会依次播放。你也可以在它们之间添加[过渡效果](https://docs.re.video/transitions)。新场景不会继承旧场景的任何节点。这对性能有积极影响，特别是当你的场景非常庞大（包含大量节点）时。在这种情况下，重新计算场景（例如在播放器中导航到新的时间点）可能是一个耗时的操作，使用多个较小的场景会更快。

然而，在大多数情况下，使用多个场景并非必要。为了逻辑分离，你可以在 `makeScene2D` 的主生成器函数外定义生成器函数，并在其中调用它们。

### `vite.config.ts`

Revideo 项目使用 [vite](https://vitejs.dev/) 进行服务。`vite.config.ts` 文件专门配置用于在运行 `npm start` 时提供可视化编辑器的服务器。默认配置如下：

```ts
import {defineConfig} from 'vite';
import motionCanvas from '@revideo/vite-plugin';

export default defineConfig({
  plugins: [motionCanvas()],
});
```

如你所见，默认设置已经足够，我们只需修改使用 'motionCanvas' 插件。这个插件启用 Motion Canvas / Revideo 相关功能，比如浏览器（用于渲染和绘制 HTML canvas）与运行 ffmpeg 进行音频处理的"后端"进程之间的通信。

你可以修改 motion canvas 插件的一些设置，例如指定默认 `project.ts` 以外的项目文件，或选择默认 `./output` 以外的输出文件夹。你也可以在这里修改一些 vite 服务器设置，比如应用程序的服务端口：

```ts
import {defineConfig} from 'vite';
import motionCanvas from '@revideo/vite-plugin';

export default defineConfig({
  plugins: [
    motionCanvas({
      output: './other-output-folder',
      project: './src/project2.ts',
    }),
  ],
  server: {
    port: 5000,
  },
});
```

### `./src/render.ts`

这个文件包含渲染视频的代码。默认情况下，你可以通过运行 `npm run render` 来执行其代码（假设你使用 `npm init @revideo@latest` 引导项目）。注意，[`renderVideo()`](https://docs.re.video/api/renderer/renderVideo) 函数接受自己的变量，而不使用 `./src/project.ts` 中的变量。

```tsx
import {renderVideo} from '@revideo/renderer';

async function render() {
    console.log('Rendering video...');

    // 这是渲染视频的主要函数
    const file = await renderVideo({
        projectFile: './src/project.ts',
        variables: { video: "" }
        settings: { logProgress: true }
    });

    console.log(`Rendered video to ${file}`);
}

render();
```

这段代码对于启动编辑器或项目并非必需，也不与任何其他渲染功能（如来自 `npx revideo serve` 的开发服务器渲染器）相关联。如果你不需要它，可以安全地删除它。

### `/public` 中的文件

如果你想使用本地文件，可以将它们放在 `/public` 文件夹中。然后你可以在场景中通过它们的名称访问它们：

```tsx
import {Video, makeScene2D} from '@revideo/2d';
import {waitFor} from '@revideo/core';

export default makeScene2D(function* (view) {
  yield view.add(
    <Video src={'/my-video.mp4'} size={['100%', '100%']} play={true} />,
  );

  yield* waitFor(10);
});
```
