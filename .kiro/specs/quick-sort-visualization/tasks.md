# 实现计划

- [x] 1. 创建项目基础结构和配置系统


  - 在 `packages/examples/src/scenes/` 目录下创建 `quick-sort.tsx` 文件
  - 定义 `QuickSortConfig` 接口，包含数组配置、视觉配置、颜色配置、动画配置和算法配置
  - 定义 `BarData` 接口，包含 value、ref、labelRef、index 和 isSorted 属性
  - 创建 `DEFAULT_CONFIG` 常量，提供所有配置项的默认值和中文注释
  - 实现 `validateConfig()` 函数，验证配置参数的有效性
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8_



- [ ] 2. 实现数据初始化和 UI 组件渲染
  - 实现 `generateRandomArray()` 函数，根据配置生成随机数组
  - 实现 `calculateScale()` 函数，根据数组值范围计算合适的缩放比例
  - 实现 `calculateX()` 函数，计算条形图的 X 坐标位置
  - 在 `makeScene2D` 中创建场景，设置背景颜色
  - 创建条形图组件数组，使用 `Rect` 组件渲染每个条形
  - 创建数值标签组件数组，使用 `Txt` 组件显示每个条形的数值
  - 创建说明文本组件 (`subtitleRef`)，用于显示当前步骤说明
  - 创建标题文本组件，显示"快速排序算法演示"
  - 实现初始淡入动画，使所有条形图和标签从透明变为可见





  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 8.2, 8.4_

- [ ] 3. 实现基准选择功能
  - 实现 `selectPivot()` 生成器函数，根据配置的策略选择基准元素
  - 支持三种基准选择策略：最右边 ('right')、最左边 ('left')、随机 ('random')
  - 实现 `highlightPivot()` 函数，高亮显示被选为基准的条形（使用红色）


  - 在基准条形上方添加 "Pivot" 标签
  - 显示说明文本，例如"选择索引 X 的元素作为基准"
  - 添加缩放动画强调基准元素（使用 `easeOutBack` 缓动函数）
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 6.5_

- [ ] 4. 实现分区过程可视化
  - 实现 `partitionGenerator()` 生成器函数，执行分区操作
  - 创建指针组件（使用 `Line` 和 `Txt`），表示 i 和 j 指针
  - 实现 `createPointer()` 函数，创建指针的视觉表示
  - 实现 `movePointer()` 函数，动画移动指针到新位置


  - 实现 `highlightCompare()` 函数，高亮当前正在比较的元素（使用蓝色）
  - 实现 `swapBars()` 函数，执行条形交换动画
  - 在交换时显示说明文本，例如"交换元素 X 和 Y"
  - 实现 `removePointers()` 函数，移除指针组件
  - 在分区完成后显示说明文本，例如"基准元素已就位"
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

- [x] 5. 实现递归子数组处理可视化


  - 实现 `quickSortGenerator()` 生成器函数，递归执行快速排序
  - 实现 `highlightPartition()` 函数，使用不同颜色区分左右子数组
  - 使用绿色表示左半区，紫色表示右半区（通过 stroke 属性）
  - 显示递归层级信息，例如"第 2 层递归：处理索引 X 到 Y"
  - 实现 `markAsSorted()` 函数，将单个元素标记为已排序（使用金色/绿色）
  - 处理递归基准情况（子数组只有一个元素或为空）


  - 显示递归返回的说明文本，例如"左子数组排序完成"
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [ ] 6. 实现最终状态展示和完成动画
  - 在排序完成后，将所有条形变为统一的完成颜色（绿色）
  - 显示完成文本，例如"排序完成！"


  - 实现庆祝动画：条形依次闪烁或波浪效果
  - 使用 `all()` 并行执行所有条形的颜色变化动画
  - 保持最终状态足够时间让学习者观察结果（至少 2 秒）
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 7. 实现辅助函数和工具方法
  - 实现 `showSubtitle()` 函数，显示和更新说明文本


  - 实现 `resetColor()` 函数，将条形恢复为默认颜色
  - 实现 `calculateBarHeight()` 函数，根据数值计算条形高度
  - 实现错误处理逻辑，捕获动画执行中的异常
  - 添加控制台日志，记录关键步骤（用于调试）
  - _需求: 8.2, 8.3, 8.6_



- [ ] 8. 优化性能和用户体验
  - 调整动画时长，确保流畅性和可理解性的平衡
  - 使用适当的缓动函数（`easeInOutCubic`、`easeOutBack` 等）
  - 确保颜色对比度足够，便于区分不同状态
  - 处理大数组情况，自动调整条形宽度和间距
  - 在关键步骤之间添加适当的暂停时间（使用 `waitFor()`）
  - 确保视觉层次清晰，避免元素重叠
  - _需求: 8.1, 8.3, 8.4, 8.5, 8.6, 8.7_

- [ ] 9. 集成项目变量支持
  - 使用 `useScene().variables.get()` 读取项目变量
  - 支持通过项目变量覆盖配置项（如 arraySize、pivotStrategy）
  - 为每个可配置参数提供合理的默认值
  - 添加注释说明如何通过项目变量自定义配置
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5, 7.5_

- [ ] 10. 代码审查和文档完善
  - 添加详细的中文注释，说明关键逻辑和算法步骤
  - 确保代码风格与 `euclidean-algorithm.tsx` 一致
  - 在文件顶部添加配置区域的醒目注释
  - 验证所有 TypeScript 类型定义正确
  - 确保没有 ESLint 或 TypeScript 编译错误
  - _需求: 7.2, 7.3, 7.6, 7.7, 7.8_
